"0","## 1. Get the order of horizons from your factor"
"0","h_levels <- levels(horizon_sub$HorizonFlip)"
"0",""
"0","## 2. Summarise to surface / subsurface per site"
"0","summ_surfsub <- horizon_sub %>%"
"0","  mutate(layer = case_when("
"0","    HorizonFlip %in% c(""O"", ""A"") ~ ""Surface"","
"0","    HorizonFlip %in% c(""B"", ""C"") ~ ""Subsurface"","
"0","    TRUE ~ NA_character_"
"0","  )) %>%"
"0","  filter(!is.na(layer)) %>%"
"0","  group_by(Location_knzmerge, layer) %>%"
"0","  summarise("
"0","    mean_eff = mean(MA_Efficiency * 100, na.rm = TRUE),"
"0","    sd_eff   = sd(MA_Efficiency * 100, na.rm = TRUE),"
"0","    se_eff   = sd(MA_Efficiency * 100, na.rm = TRUE) / sqrt(dplyr::n()),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  ## 3. Put surface between O/A, subsurface between B/C"
"0","  mutate("
"0","    x_pos = case_when("
"0","      layer == ""Surface""   ~ mean(match(c(""O"", ""A""), h_levels), na.rm = TRUE),"
"0","      layer == ""Subsurface""~ mean(match(c(""B"", ""C""), h_levels), na.rm = TRUE)"
"0","    )"
"0","  )"
"0",""
"0","# 3. Convert horizon from factor to numeric to place new layer averages between O/A and B/C"
"0","horizon_sub <- horizon_sub %>%"
"0","  mutate(h_num = as.numeric(HorizonFlip))"
"0",""
"0","####################################################################"
"0",""
"0","ma = ggplot() + theme_bw() + coord_flip() + "
"0","  ## Original points (per profile, per horizon)"
"0","  geom_jitter(data = horizon_sub,"
"0","             aes(x = h_num, y = MA_Efficiency * 100),"
"0","             size = 2, alpha = 0.6, color = 'black',"
"0","             width = 0.05, height = 0.05) +"
"0","  ## New surface / subsurface summary points + error bars"
"0","  geom_pointrange(data = summ_surfsub, color = ""#415783"", pch = 17, size = 1,"
"0","                  aes(x = x_pos, y = mean_eff,"
"0","                      ymin = mean_eff - se_eff,"
"0","                      ymax = mean_eff + se_eff)) +"
"0","  geom_line(data = summ_surfsub, color = ""#415783"","
"0","            aes(x_pos, mean_eff), alpha = 0.4) +"
"0","  ## Use numeric x but label with horizons"
"0","  scale_x_continuous(breaks = seq_along(h_levels),"
"0","                     labels = h_levels) +"
"0","  facet_wrap(~Location_knzmerge, ncol = 7, scales = ""free_x"") +"
"0","  theme(axis.text.x  = element_text(size = 11, color = ""black""),"
"0","        axis.text.y  = element_text(size = 11, color = ""black""),"
"0","        axis.title.y = element_text(size = 12.5, margin = margin(r = 11.5)),"
"0","        axis.title.x = element_text(size = 12.5),"
"0","        plot.title   = element_text(size = 11, face = ""bold""),"
"0","        panel.grid   = element_line(color = ""white""),"
"0","        panel.grid.major.y = element_line(color = ""gray97""),"
"0","        strip.text   = element_text(size = 10.5),"
"0","        strip.background = element_blank()) +"
"0","  labs(y = ""P extraction efficiency (%)"","
"0","       x = ""Horizon"","
"0","       title = ""Malic acid"")"
